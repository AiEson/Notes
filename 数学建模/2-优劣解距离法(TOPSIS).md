# 优劣解距离法 TOPSIS

## 引入

### 层次分析法的一些局限

- 评价决策层数不能太多，判断矩阵和一致矩阵之间的差异会很大
- 如果决策层中的指标数据是**已知的**，如何利用这些数据得到更精确的评价呢？层次分析法并没有讨论这类问题

### 小例子

小明宿舍共四名同学，假设高数成绩如下表：

| 姓名 | 成绩 |
| :--: | :--: |
| 小明 |  89  |
| 小王 |  60  |
| 小张 |  74  |
| 小红 |  99  |

请你**为这四名同学进行评分**，该评分能合理的描述其高数成绩的高低

---

**Tips：**

我们一般进行名次排名的时候，是**越小越好**，但是我们使用数学模型评价一类问题的时候，最后的量化结果往往都是**越大越好**，这样就造成了**矛盾**

为了修正上面这一问题，我们需要对排名进行**修正操作**

---

修正后的如下表：

| 姓名 | 成绩 | 排名 | 修正后排名 |         评分         |
| :--: | :--: | :--: | :--------: | :------------------: |
| 小明 |  89  |  2   |     3      | $\frac{3}{10} = 0.3$ |
| 小王 |  60  |  4   |     1      | $\frac{1}{10} = 0.1$ |
| 小张 |  74  |  3   |     2      | $\frac{2}{10} = 0.2$ |
| 小红 |  99  |  1   |     4      | $\frac{4}{10} = 0.4$ |

 ^ 为什么是 $/10$ 呢？因为还是要进行**归一化处理**（因为 $1+2+3+4 = 10$）

#### 上述想法的不合理之处

加入我们将小王的成绩修改为 $10$ 分，那么最终评价**依旧是不变的**

也就是：**只要保证排名不变，那么最终的评分就不会变！**

所以，我们此处给定的评分，并**不能合理的描述**其高数成绩的高低

#### 一个比较好的想法

构造一个公式：
$$
\frac{x - min}{max - min}
$$
则我们通过上述公式可以得到下表：

| 姓名 | 成绩 |            未归一化评分            |              最终评分               |
| :--: | :--: | :--------------------------------: | :---------------------------------: |
| 小明 |  89  | $\frac{(89 - 60)}{99 - 69} = 0.74$ | $\frac{0.74}{0.74+0+0.36+1} = 0.35$ |
| 小王 |  60  |            $\cdots= 0$             |            $\cdots = 0$             |
| 小张 |  74  |           $\cdots= 0.36$           |           $\cdots = 0.17$           |
| 小红 |  99  |            $\cdots= 1$             |           $\cdots = 0.48$           |

 ^ 为什么这里的 $max \neq 100,min\neq0$ ？

原因有三点：

- 比较对象一般远大于两个
- 比较对象的指标也往往不止一个方面
- 很多指标**不存在理论上的最大值和最小值**，录入经济增长水平的指标：GDP 增速

### 拓展问题：指标个数增加

对于上述例子我们新增加一个指标**「与他人争吵的次数」**，如下表；

| 姓名 | 成绩 | 争吵次数 |
| :--: | :--: | :------: |
| 小明 |  89  |    2     |
| 小王 |  60  |    0     |
| 小张 |  74  |    1     |
| 小红 |  99  |    3     |

对于上面的两个指标我们进行约定：

- 成绩**越大越好**，这样的指标称为**「极大型指标（效益型指标）」**
- 争吵次数**越少越好**，这样的指标称为**「极小型指标（成本型指标）」**

上述的指标有正反两类，处理起来不是很方便，那么我们如何进行指标类型的统一呢

#### 统一指标类型

##### 指标正向化

这是一种**最常用**的指标统一方法，如果论文中使用到了**一定**要出现指标正向化的字眼

|   姓名   |  成绩  | 争吵次数 | 正向化后争吵次数 |
| :------: | :----: | :------: | :--------------: |
|   小明   |   89   |    2     |    3 - 2 = 1     |
|   小王   |   60   |    0     |      … = 3       |
|   小张   |   74   |    1     |      … = 2       |
|   小红   |   99   |    3     |      … = 0       |
| 指标类型 | 极大型 |  极小型  |      极大型      |

 ^ 极小型指标转化为极大型指标的公式为：
$$
max - x
$$

##### 标准化处理

为了**消除不同指标量纲的影响**，需要对已经正向化的矩阵进行**标准化处理**

###### 计算公式

假设有 $n$ 个要评价的对象，$m$ 个（已经正向化了的）评价指标，二者构成的**正向化矩阵**如下：
$$
X=\left[\begin{array}{cccc}
x_{11} & x_{12} & \cdots & x_{1 m} \\
x_{21} & x_{22} & \cdots & x_{2 m} \\
\vdots & \vdots & \ddots & \vdots \\
x_{n 1} & x_{n 2} & \cdots & x_{n m}
\end{array}\right]
$$
那么，$X$ 的标准化矩阵记为 $Z$，$Z$ 中的每一个元素的计算公式如下：
$$
z_{ij} = \frac{x_{ij}}{\sqrt{\sum\limits^n_{i = 1}x^2_{ij}}}
$$
我们套用公式：
$$
\begin{bmatrix}
89 & 1\\
60 & 3\\
74 & 2\\
99 & 0
\end{bmatrix}

\to
\begin{bmatrix}
0.5437 & 0.2673\\
0.3665 & 0.8018\\
0.4520 & 0.5345\\
0.6048 & 0
\end{bmatrix}
$$

##### 得分的计算

当我们只有一个指标的时候，构造评分公式为：
$$
\frac{x - min}{max - min}
$$
那么将其变一下型为：
$$
\frac{x - min}{(max - x) + (x - min)}
$$
可以**理解为：**
$$
\frac{x 与最小值的距离}{x 与最大值的距离 + x与最小值的距离}
$$
假设有 $n$ 个要评价的对象，$m$ 个评价指标的标准化矩阵：
$$
Z=\left[\begin{array}{cccc}
z_{11} & z_{12} & \cdots & z_{1 m} \\
z_{21} & z_{22} & \cdots & z_{2 m} \\
\vdots & \vdots & \ddots & \vdots \\
z_{n 1} & z_{n 2} & \cdots & z_{n m}
\end{array}\right]
$$
定义最大值 $Z^+$
$$
\begin{aligned}
Z^{+} &=\left(Z_{1}^{+}, Z_{2}^{+}, \cdots, Z_{m}^{+}\right) \\
&=\left(\max \left\{z_{11}, z_{21}, \cdots, z_{n 1}\right\}, \max \left\{z_{12}, z_{22}, \cdots, z_{n 2}\right\}, \cdots, \max \left\{z_{1 m}, z_{2 m}, \cdots, z_{n m}\right\}\right)
\end{aligned}
$$
定义最小值 $Z^-$
$$
\begin{aligned}
Z^{-} &=\left(Z_{1}^{-}, Z_{2}^{-}, \cdots, Z_{m}^{-}\right) \\
&=\left(\min \left\{z_{11}, z_{21}, \cdots, z_{n 1}\right\}, \min \left\{z_{12}, z_{22}, \cdots, z_{n 2}\right\}, \cdots, \min \left\{z_{1 m}, z_{2 m}, \cdots, z_{n m}\right\}\right)
\end{aligned}
$$
定义第 $i(i = 1, 2, \cdots,n)$ 个评价对象与**最大值**的距离 $D^+$​
$$
D_{i}^{+}=\sqrt{\sum_{j=1}^{m}\left(Z_{j}^{+}-z_{i j}\right)^{2}}
$$
定义第 $i(i = 1, 2, \cdots,n)$ 个评价对象与**最小值**的距离 $D^-$​
$$
D_{i}^{-}=\sqrt{\sum_{j=1}^{m}\left(Z_{j}^{-}-z_{i j}\right)^{2}}
$$
那么，我们可以计算得出第 $i(i = 1, 2, \cdots,n)$ 个评价**对象未归一化的得分** $S_i$
$$
S_{i}=\frac{D_{i}^{-}}{D_{i}^{+}+D_{i}^{-}}
$$
显然 $0 \leq S_{i} \leq 1$，且 $S_i$ 越大，$D_i^+$ 越小，即越接近最大值

通过上面的操作，我们便能很容易得到最终得评分

## TOPSIS 介绍

`TOPSIS（Technique for Order Preference by Similarity to an Ideal Solution）`可翻译为**「逼近理想解排序法」**，国内常简称**「优劣解距离法」**

TOPSIS 法是一种常用的综合评价方法，能充分利用原始数据得信息，其结果能精确地反映各评价方案之间得差距

---

**基本过程：**

先将原始数据矩阵**统一指标类型**（一般使用[正向化处理](#指标正向化)）得到正向化的矩阵，再对正向化的矩阵进行[标准化处理](#标准化处理)以**消除各个指标量纲的影响**，并找到有限方案中的**最优方案**和**最劣方案**，然后分别计算各评价对象与最优、最劣方案之间的**距离**，获得各评价对象与最优方案的**相对接近程度**，以此作为评价优劣的依据

该方法对数据分布以及样本含量并**没有严格限制**，数据计算**简单易行**

---

上面[引入部分](#引入)中的[指标正向化](#指标正向化)其实是不完整的，在此进行补充

### 原始矩阵正向化

最常见的四种指标我们列举如下：

|       指标名称       |       指标特点       |           例子           |
| :------------------: | :------------------: | :----------------------: |
| 极大型（效益型）指标 |     越**大**越好     | 成绩、GDP 增速、企业利润 |
| 极小型（成本型）指标 |     越**小**越好     |  费用、坏品率、污染程度  |
|      中间型指标      | 越**接近某个值**越好 |    水质量评估时 PH 值    |
|      区间型指标      | 越**落在某区间**越好 |   体温、水体中营养含量   |

**原式矩阵正向化：**

​	就是要将**所有的指标类型统一转化为极大型指标**（转换的函数形式**可以不唯一**）

#### 极小型指标→极大型指标

上文已经提到，转换公式为
$$
max - x
$$
特殊的，如果所有元素均为**正数**，也可以使用
$$
\frac{1}{x}
$$

#### 中间型指标→极大型指标

**中间型指标：**

​	指标值既不要太大，也不要太小，取某特定值最好（如 $PH\to7$）

---

我们令 $\{x_i\}$ 是一组中间型指标序列，且最佳的数值为 $x_{\text{best}}$，那么其正向化公式定义如下：
$$
M=\max \left\{\left|x_{i}-x_{\text {best }}\right|\right\}, \quad \tilde{x}_{i}=1-\frac{\left|x_{i}-x_{\text {best }}\right|}{M}
$$
假设我们有 PH 值表格如下：

| PH 值 |
| :---: |
|   6   |
|   7   |
|   8   |
|   9   |

那么在此处，$x_{\text{best}}$ 的计算如下：
$$
x_{\text{best}} = 7 \\
M=\max \{|6-7|,|7-7|,|8-7|,|9-7|\}=2
$$
则我们得到转换后的表格：

| PH 值（转换前） |           PH 值（转换后）           |
| :-------------: | :---------------------------------: |
|        6        | $1 - \frac{|6-7|}{2} = \frac{1}{2}$ |
|        7        |            $\cdots = 1$             |
|        8        |       $\cdots = \frac{1}{2}$        |
|        9        |            $\cdots = 0$             |

#### 区间型指标→极大型指标

**区间型指标：**

​	指标值落在**某个区间内最好**，例如人的体温在 36°C ~ 37°C 这个区间内比较好

---

我们令 $\{x_i\}$ 是一组区间型指标序列，且最佳区间为 $[a, b]$，那么其正向化公式定义如下：
$$
M=\max \left\{a-\min \left\{x_{i}\right\}, \max \left\{x_{i}\right\}-b\right\}, \tilde{x}_{i}=\left\{\begin{array}{ll}
1-\frac{a-x}{M} & , x<a \\
1 & , a \leq x \leq b \\
1-\frac{x-b}{M} & , x>b
\end{array}\right.
$$
直接套用公式即可，在此不作更详细的说明

我们对一些体温数据套用上述公式可以得到如下结果矩阵：

| 体温（转换前） | 体温（转换后） |
| :------------: | :------------: |
|      35.2      |     0.4286     |
|      35.8      |     0.8571     |
|      36.6      |       1        |
|      37.1      |     0.9286     |
|      37.8      |     0.4286     |
|      38.4      |       0        |

 ^ 其中，计算过程中的 $a = 36, b = 37, \\M=\max \{36-35.2,38.4-37\}=1.4$

剩余过程请跟随上面[得分的计算](#得分的计算)一节进行



