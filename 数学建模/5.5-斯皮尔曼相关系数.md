# 斯皮尔曼相关系数

## 定义①

假设有 $X, Y$ 两组数据，其**斯皮尔曼（等级）相关系数**的**数学定义如下：**
$$
r_{s}=1-\frac{6 \sum\limits_{i=1}^{n} d_{i}^{2}}{n\left(n^{2}-1\right)}
$$
 ^ 其中 $d_i$ 为 $X_i，Y_i$  之间的`等级差`

关于等级差，补充如下：

### 等级差

一个数的**等级**，就是将它所在的一列数，从小到大排序后，这个数所在的**位置下标**

如下表格展示了一组数据的**等级、等级差和等级差的平方**

|  X   |  Y   | X 的等级 | Y 的等级 | 等级差 | 等级差的平方 |
| :--: | :--: | :------: | :------: | :----: | :----------: |
|  3   |  5   |    2     |    1     |   1    |      1       |
|  8   |  10  |    5     |   4.5    |  0.5   |     0.25     |
|  4   |  8   |    3     |    3     |   0    |      0       |
|  7   |  10  |    4     |   4.5    |  -0.5  |     0.25     |
|  2   |  6   |    1     |    2     |   -1   |      1       |

---

根据公式 $r_{s}=1-\frac{6 \sum\limits_{i=1}^{n} d_{i}^{2}}{n\left(n^{2}-1\right)}$ 可知，对于上表所示的 $X,Y$ 的斯皮尔曼相关系数 $r_s$ 为
$$
r_{s}=1-\frac{6 \times(1+0.25+0.25+1)}{5 \times 24}=0.875
$$

## 定义②

另一种斯皮尔曼相关系数被定义为：**等级之间的皮尔逊相关系数**

那么对于上表中的 $X,Y$ 的等级，我们可以得到如下 MATLAB 代码来计算斯皮尔曼相关系数：

```matlab
RX = [2 5 3 4 1]
RY = [1 4.5 3 4.5 2]
R = corrcoef(RX, RY)
```

```
R =
    1.0000    0.8721
    0.8721    1.0000
```

## MATLAB 中计算斯皮尔曼相关系数

计算有两种方法：

- `corr(X, Y, 'type', 'Spearman')`
  - $X, Y$ 必须是**列向量**，结果为斯皮尔曼相关系数
- `corr(X, 'type', 'Spearman')`
  - 返回为 $X$ 矩阵**各列之间**的斯皮尔曼相关系数

依旧是使用女生体测数据进行计算，代码如下：

```matlab
clear;clc
load 'physical fitness test.mat'
spearman = corr(Test, 'type', 'Spearman')
person = corrcoef(Test)
```

```
spearman =
    1.0000    0.0301   -0.2430   -0.1990    0.0624    0.1099
    0.0301    1.0000    0.1305    0.0898    0.0216   -0.0488
   -0.2430    0.1305    1.0000    0.2626    0.0219   -0.0801
   -0.1990    0.0898    0.2626    1.0000   -0.0910   -0.0029
    0.0624    0.0216    0.0219   -0.0910    1.0000   -0.0399
    0.1099   -0.0488   -0.0801   -0.0029   -0.0399    1.0000

person =
    1.0000    0.0665   -0.2177   -0.1920    0.0440    0.0951
    0.0665    1.0000    0.0954    0.0685    0.0279   -0.0161
   -0.2177    0.0954    1.0000    0.2898    0.0248   -0.0749
   -0.1920    0.0685    0.2898    1.0000   -0.0587   -0.0019
    0.0440    0.0279    0.0248   -0.0587    1.0000   -0.0174
    0.0951   -0.0161   -0.0749   -0.0019   -0.0174    1.0000
```

## 斯皮尔曼相关系数假设检验

### 小样本情况 n <= 30

![啊啊啊](5.5-斯皮尔曼相关系数.assets/啊啊啊.svg)

原假设和备择假设定义如下：
$$
H_0: r_s = 0, \\
H_0: r_s \ne 0
$$
小样本情况下，直接**查如上所示的表**即可

拒绝原假设，即接受备择假设，即斯皮尔曼相关系数是显著异于 $0$ 的

### 大样本情况 n > 30

大样本情况下，我们构造统计量：
$$
P = r_s\sqrt{n - 1} \sim N(0, 1),\\
H_0: r_s = 0, \\
H_0: r_s \ne 0
$$
将得到的 $P$ 值（双侧检验须$\times2$）与对应的置信水平 $0.05$ 相比较即可

当 $P$ 值 $> 0.05$ ，我们无法拒绝原假设，即 $r_s$ 和 $0$ 没有显著差异

